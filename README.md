# NeameGraph – Corporate Schema Control

A web application for managing JSON-LD schema for the corporate section of shepherdneame.co.uk (~200 pages).

## Features

- **Page Management**: Track and organize corporate pages with status tracking
- **AI Schema Generation**: Generate JSON-LD schema using AI with customizable prompts
- **Version Control**: Maintain multiple versions of schema per page with approval workflow
- **Knowledge Graph**: Visualize entities and relationships from approved schemas
- **Role-Based Access**: Three user roles with different permissions (Admin, Editor, Viewer)
- **Audit Logging**: Complete history of all system changes
- **Sitemap Sync**: Automatic page discovery from sitemap

## User Roles

### Admin
- Full system access
- Manage users and roles
- Edit global settings (URLs, sitemap)
- Create and manage AI rules/prompts
- Approve schemas and mark as implemented
- Run sitemap sync and graph rebuilds

### Editor
- View all pages, schemas, and graph
- Add and edit pages
- Fetch HTML and generate schemas
- Set page statuses (ai_draft, needs_review)
- Cannot edit rules, settings, or manage users

### Viewer
- Read-only access to pages, schemas, and graph
- Can copy JSON-LD
- Cannot generate, edit, or approve anything

## Getting Started

### First-Time Setup

1. **Create Your Account**: Visit `/auth` and sign up with email and password
2. **Upgrade to Admin**: Your first account will be created as a 'viewer'. To upgrade to admin:
   - Go to Lovable Cloud tab → Database → Tables → `users`
   - Find your user record and change `role` from `viewer` to `admin`
3. **Configure Settings**: As admin, visit Settings to set:
   - Canonical Base URL (for JSON-LD @id values)
   - Fetch Base URL (for retrieving HTML)
   - Sitemap URL (for automatic page discovery)
   - Preview auth credentials (if needed)

### Adding Pages

**Manual Bulk Import:**
1. Go to Pages
2. Click "Bulk Add Pages"
3. Enter one path per line (e.g., `/beers/spitfire`)
4. Section and page_type will be auto-detected based on path

**Sitemap Sync:**
1. Go to Settings
2. Click "Run Sitemap Sync"
3. All corporate pages from the sitemap will be automatically added

### Creating AI Rules

1. Go to Rules (admin only)
2. Click "New Rule"
3. Enter a name and the full system prompt for schema generation
4. Set as "Active" – only one rule can be active at a time
5. This prompt will be used for all AI schema generation

### Generating Schema

1. Open a page detail view
2. Click "Fetch HTML" to retrieve the current page HTML
3. Click "Generate Schema" to create JSON-LD using the active rule
4. Review the generated schema in the versions list
5. Admin can approve, reject, or mark as implemented

## Architecture

### Database Tables

- `settings` - Single-row config for URLs and auth
- `users` - User accounts with roles
- `pages` - Corporate pages being tracked
- `rules` - AI prompt versions for schema generation
- `schema_versions` - Versioned JSON-LD per page
- `audit_log` - Complete change history
- `graph_nodes` - Knowledge graph entities
- `graph_edges` - Knowledge graph relationships

### Status Flow

Pages follow this status workflow:
- `not_started` → Initial state
- `ai_draft` → Schema generated by AI
- `needs_review` → Flagged for review
- `approved` → Ready for implementation
- `implemented` → Live on site
- `needs_rework` → Requires changes
- `removed_from_sitemap` → No longer in sitemap

## Corporate Scope

This app manages **corporate-only** schema:
- Beer brand pages (as Brand, not Product)
- Pub estate overview/finder pages
- History, sustainability, investors, careers
- News, articles, press releases
- FAQs and general corporate content

**Not Included:**
- Individual pub LocalBusiness pages
- Shopify product pages
- These will be handled by separate apps

## Important Behaviours

1. **Canonical URLs**: All JSON-LD `url` and `@id` values use `canonical_base_url`
2. **Fetch URLs**: HTML is fetched from `fetch_base_url` (preview or live)
3. **Beer Brands**: Always treated as Brand schema, never Product/Offer
4. **No sameAs Guessing**: AI is instructed not to guess sameAs URLs
5. **Auto Schema-ID**: Organization node must be `https://www.shepherdneame.co.uk/#organization`

## Technology Stack

- **Frontend**: React, TypeScript, Tailwind CSS, shadcn/ui
- **Backend**: Lovable Cloud (Supabase)
- **Database**: PostgreSQL with Row Level Security
- **AI**: Lovable AI (for schema generation)

## Development

This is a Lovable project. To make changes:
- Use the Lovable editor at https://lovable.dev/projects/29051ea2-9e2d-469a-8d32-4e009feb6899
- Or clone this repo and push changes (requires Node.js & npm)

```sh
npm install
npm run dev
```

## Future Enhancements

- Edge functions for HTML fetching and AI generation
- Google Rich Results validation integration
- Visual graph rendering with D3 or similar
- Batch operations for multiple pages
- Export functionality for approved schemas
- Webhook notifications for status changes
